//
//  MarketDataModel.swift
//  SwiftfulCrypto
//
//  Created by Pasya Sahas on 10/31/24.
//

import Foundation

// JSON data
/*
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {"data":{"active_cryptocurrencies":15077,"upcoming_icos":0,"ongoing_icos":49,"ended_icos":3376,"markets":1143,"total_market_cap":{"btc":35065844.09359235,"eth":969631288.0983744,"ltc":35390464205.908806,"bch":6826342496.045722,"bnb":4288754870.4356046,"eos":5547522392885.932,"xrp":4863112686642.874,"xlm":26868955820705.27,"link":211126508421.88956,"dot":622279929534.1954,"yfi":517448064.26995933,"usd":2479320900404.2764,"aed":9106545667184.908,"ars":2.453534971311711e+15,"aud":3779570994770.492,"bdt":296097162962729.2,"bhd":934572575444.6896,"bmd":2479320900404.2764,"brl":14360722519321.65,"cad":3454846898481.8433,"chf":2145001832231.0605,"clp":2.384015804992736e+15,"cny":17647806169077.617,"czk":57807350249646.04,"dkk":17033256897494.41,"eur":2283660332907.0693,"gbp":1924902598618.5708,"gel":6805735871609.7295,"hkd":19275158028475.984,"huf":932000215548175.9,"idr":3.89590437081262e+16,"ils":9280717960438.295,"inr":208480600339880.03,"jpy":377634043963727.2,"krw":3.412110608586088e+15,"kwd":760152350101.248,"lkr":725479044829774.6,"mmk":5.201615249048178e+15,"mxn":49703429557980.125,"myr":10856450358690.232,"ngn":4073003581975152.5,"nok":27325971666455.227,"nzd":4161016994618.5884,"php":144616836895032.66,"pkr":688528099016540.4,"pln":9937985931135.49,"rub":241112928646141.88,"sar":9311320218312.006,"sek":26500184254157.582,"sgd":3278983708374.366,"thb":83887175562423.52,"try":84971779283514.48,"twd":79193759114935.73,"uah":102118675854478.94,"vef":248254401757.4801,"vnd":6.268035032147409e+16,"zar":43786912044583.76,"xdr":1862517926122.5996,"xag":75903194498.63554,"xau":903985193.4964033,"bits":35065844093592.35,"sats":3506584409359235.5},"total_volume":{"btc":1551888.8514745277,"eth":42912413.05997025,"ltc":1566255376.6870313,"bch":302109505.4117339,"bnb":189804952.43096974,"eos":245513501167.8825,"xrp":215223975265.56317,"xlm":1189123891545.8936,"link":9343704198.198513,"dot":27539884183.678852,"yfi":22900400.743650213,"usd":109725876105.98169,"aed":403023142937.27075,"ars":108584683104129.0,"aud":167270295119.25043,"bdt":13104201482463.756,"bhd":41360839820.52143,"bmd":109725876105.98169,"brl":635554219581.0673,"cad":152899167948.0217,"chf":94930109794.22272,"clp":105508013428467.75,"cny":781028786122.3767,"czk":2558346582111.8486,"dkk":753831033211.987,"eur":101066639141.3258,"gbp":85189304868.79027,"gel":301197529910.9194,"hkd":853049559422.0605,"huf":41246996371188.66,"idr":1724187942927570.5,"ils":410731385733.7154,"inr":9226605769210.537,"jpy":16712732230268.463,"krw":151007812597624.62,"kwd":33641624436.465584,"lkr":32107107949397.613,"mmk":230204888070349.88,"mxn":2199696034842.4565,"myr":480467666292.8721,"ngn":180256572008146.16,"nok":1209349778425.262,"nzd":184151730884.0317,"php":6400223998997.409,"pkr":30471791237615.504,"pln":439819715489.4121,"rub":10670795915068.121,"sar":412085732222.4925,"sek":1172803380870.6428,"sgd":145116092104.07217,"thb":3712546379592.2197,"try":3760547061353.5474,"twd":3504832552976.6943,"uah":4519407380096.853,"vef":10986851974.491941,"vnd":2774008137684851.5,"zar":1937852129300.4417,"xdr":82428382374.21162,"xag":3359203931.30533,"xau":40007151.68700199,"bits":1551888851474.5278,"sats":155188885147452.78},"market_cap_percentage":{"btc":56.39624971587002,"eth":12.430048151693343,"usdt":4.860271468452429,"bnb":3.4013741853119437,"sol":3.2277450146043574,"usdc":1.4119011527946468,"xrp":1.1684898803916,"steth":1.0049015305545927,"doge":0.9810588296108791,"trx":0.5874550232645797},"market_cap_change_percentage_24h_usd":-3.7035283585669867,"updated_at":1730391872}}
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: {$0.key == "usd"}){
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: {$0.key == "usd"}){
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String{
        if let item = marketCapPercentage.first(where: {$0.key == "btc"}) {
            return item.value.asPercentString()
        }
        return ""
    }
    
}
